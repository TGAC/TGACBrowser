
/* jquery.cytoscapeweb.layout.arbor.min.js */

/**
 * This file is part of Cytoscape Web 2.0-prerelease-snapshot-2012.05.23-17.59.27.
 * 
 * Cytoscape Web is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Cytoscape Web is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * Cytoscape Web. If not, see <http://www.gnu.org/licenses/>.
 */
 
(function(b,a){var c={liveUpdate:true,ready:undefined,maxSimulationTime:4000,fit:true,padding:[50,50,50,50],ungrabifyWhileSimulating:true,repulsion:undefined,stiffness:undefined,friction:undefined,gravity:true,fps:undefined,precision:undefined,nodeMass:undefined,edgeLength:undefined,stepSize:1,stableEnergy:function(f){var g=f;return(g.max<=7)||(g.mean<=5)}};function d(e){this.options=b.extend(true,{},c,e)}d.prototype.run=function(){var l=this.options;var k=l.cy;var u=k.nodes();var j=k.edges();var w=k.container();
if(k.nodes().size()<=1){if(l.fit){k.reset()}k.nodes().position({x:w.width()/2,y:w.height()/2});k.one("layoutstop",l.stop);k.trigger("layoutstop");k.one("layoutstop",l.stop);k.trigger("layoutstop");return}var n=this.system=arbor.ParticleSystem(l.repulsion,l.stiffness,l.friction,l.gravity,l.fps,l.dt,l.precision);if(l.liveUpdate&&l.fit){k.reset()}var s=250;var h;var p=false;var g=+new Date;var q={init:function(x){},redraw:function(){var y=n.energy();if(l.stableEnergy!=null&&y!=null&&l.stableEnergy(y)){n.stop();
return}clearTimeout(h);h=setTimeout(v,s);var z=k.collection();n.eachNode(function(F,A){var E=F.name;var C=F.data;var B=C.element;if(B==null){return}var D=B.position(false);if(!B.locked()&&!B.grabbed()){D.x=A.x;D.y=A.y;z=z.add(B)}});var x=(+new Date-g)>=16;if(l.liveUpdate&&z.size()>0&&x){z.rtrigger("position");g=+new Date}if(!p){p=true;k.one("layoutready",l.ready);k.trigger("layoutready")}}};n.renderer=q;var t=w.width();var r=w.height();n.screenSize(t,r);n.screenPadding(l.padding[0],l.padding[1],l.padding[2],l.padding[3]);
n.screenStep(l.stepSize);function o(x,y){if(y==null){return undefined}else{if(typeof y==typeof function(){}){return y.apply(x,[x.data(),{nodes:u.size(),edges:j.size(),element:x}])}else{return y}}}function e(D){var G=D.x;var E=D.y;var H=t;var B=r;var A=-2;var I=2;var F=-2;var z=2;var C=4;return{x:G/H*C+A,y:E/B*C+I}}var m=function(y){grabbed=this;var z=n.fromScreen(this.position(false));var x=arbor.Point(z.x,z.y);this.scratch().arbor.p=x;switch(y.type){case"grab":this.scratch().arbor.fixed=true;break;
case"dragstop":this.scratch().arbor.fixed=false;this.scratch().arbor.tempMass=1000;break}};u.bind("grab drag dragstop",m);u.each(function(z,A){var C=this._private.data.id;var y=o(this,l.nodeMass);var x=this._private.locked;var B=e({x:A.position(false).x,y:A.position(false).y});this.scratch().arbor=n.addNode(C,{element:this,mass:y,fixed:x,x:x?B.x:undefined,y:x?B.y:undefined})});j.each(function(){var A=this.id();var y=this.source().id();var z=this.target().id();var x=o(this,l.edgeLength);this.scratch().arbor=n.addEdge(y,z,{length:x})
});function i(x){if(l.fit){k.fit()}x()}var f=u.filter(":grabbable");if(l.ungrabifyWhileSimulating){f.ungrabify()}var v=function(){if(b.browser.msie){i(function(){x()})}else{x()}function x(){if(!l.liveUpdate){if(l.fit){k.reset()}k.nodes().rtrigger("position")}u.unbind("grab drag dragstop",m);if(l.ungrabifyWhileSimulating){f.grabify()}k.one("layoutstop",l.stop);k.trigger("layoutstop")}};n.start();setTimeout(function(){n.stop()},l.maxSimulationTime)};d.prototype.stop=function(){if(this.system!=null){system.stop()
}};b.cytoscapeweb("layout","arbor",d)})(jQuery,jQuery.cytoscapeweb);